<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        <record id="juragan_product.search_product_mapping_view" model="ir.ui.view">
            <field name="name">Product Mapping Search View</field>
            <field name="model">product.mapping</field>
            <field name="arch" type="xml">
                <search string="Product Mapping Search">
                    <field name="product_product_izi_id" string="IZI ID" filter_domain="[('product_product_izi_id','ilike',self)]"/>
                    <field name="reference" string="Product Marketplace" filter_domain="[('reference','ilike',self)]"/>
                    <field name="product_id" string="Product Odoo" filter_domain="[('product_id','ilike',self)]"/>
                    <field name="order_product_id" string="Product in Order" filter_domain="[('order_product_id','ilike',self)]"/>
                    <separator/>
                    <filter string="Product Odoo Not Mapped" name="status_product_id" domain="[('status_product_id','=', 'not_map')]"/>
                    <filter string="Product Odoo System Mapped" name="status_product_id" domain="[('status_product_id','=', 'system_map')]"/>
                    <filter string="Product Odoo User Mapped" name="status_product_id" domain="[('status_product_id','=', 'user_map')]"/>
                    <filter string="Product Odoo System Deleted" name="status_product_id" domain="[('status_product_id','=', 'system_del')]"/>
                    <filter string="Product Odoo User Deleted" name="status_product_id" domain="[('status_product_id','=', 'user_del')]"/>
                    <separator/>
                    <filter string="Product in Order Not Mapped" name="status_order_product_id" domain="[('status_order_product_id','=', 'not_map')]"/>
                    <filter string="Product in Order System Mapped" name="status_order_product_id" domain="[('status_order_product_id','=', 'system_map')]"/>
                    <filter string="Product in Order User Mapped" name="status_order_product_id" domain="[('status_order_product_id','=', 'user_map')]"/>
                    <filter string="Product in Order System Deleted" name="status_order_product_id" domain="[('status_order_product_id','=', 'system_del')]"/>
                    <filter string="Product in Order User Deleted" name="status_order_product_id" domain="[('status_order_product_id','=', 'user_del')]"/>
                </search>
            </field>
        </record>

        <record id="juragan_product.tree_product_mapping_view" model="ir.ui.view">
            <field name="name">Product Mapping Tree View</field>
            <field name="model">product.mapping</field>
            <field name="priority">1</field>
            <field name="arch" type="xml">
                <tree string="Product Mapping" editable="bottom" create="0" delete="0" default_order="reference asc">
                    <field name="product_product_izi_id" string="IZI ID" readonly="1"/>
                    <field name="reference" string="Product Marketplace" readonly="1"/>
                    <field name="product_id" string="Product Odoo" domain="[('product_mapping_ids', '=', False)]"/>
                    <field name="status_product_id" string="Status Product Odoo" readonly="1"/>
                    <field name="order_product_id" string="Product in Order"/>
                    <field name="status_order_product_id" string="Status Product in Order" readonly="1"/>
                </tree>
            </field>
        </record>

        <record id="juragan_product.action_window_product_mapping_view" model="ir.actions.act_window">
            <field name="name">Product Mapping</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">product.mapping</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="juragan_product.tree_product_mapping_view"/>
        </record>



        <record model="ir.actions.server" id="multi_confirm">
            <field name="name">Confirm Orders</field>
            <field name="model_id" ref="sale.model_sale_order"/>
            <field name="binding_model_id" ref="sale.model_sale_order"/>
            <field name="state">code</field>
            <field name="sequence">6</field>
            <field name="code">
if records:
    order_statuses = records.mapped('state')
    allowed_statuses = ['draft']
    if not all(order_status in allowed_statuses for order_status in order_statuses):
        raise Warning("The status of your selected orders should be in {}".format(allowed_statuses))
    records.action_confirm()
else:
    raise Warning("Please select sale order first!")
            </field>
        </record>
        <record model="ir.actions.server" id="multi_get_label">
            <field name="name">Get Label</field>
            <field name="model_id" ref="sale.model_sale_order"/>
            <field name="binding_model_id" ref="sale.model_sale_order"/>
            <field name="state">code</field>
            <field name="sequence">8</field>
            <field name="code">
if records:
    order_statuses = records.mapped('order_status')
    allowed_statuses = ['ready-process', 'process', 'ready-ship', 'ship']
    if not all(order_status in allowed_statuses for order_status in order_statuses):
        raise Warning("The status of your selected orders should be in {}".format(allowed_statuses))
    action = records.action_orders_get_label()
else:
    raise Warning("Please select sale order first!")
            </field>
        </record>

        <record model="ir.actions.server" id="multi_cancel">
            <field name="name">Cancel Orders</field>
            <field name="model_id" ref="sale.model_sale_order"/>
            <field name="binding_model_id" ref="sale.model_sale_order"/>
            <field name="state">code</field>
            <field name="sequence">10</field>
            <field name="code">
if records:
    tp_orders = records.mapped('mp_tokopedia_id')
    shp_orders = records.mapped('mp_shopee_id')
    lz_orders = records.mapped('mp_lazada_id')

    if tp_orders and shp_orders:
        raise Warning("You can only select orders from same marketplace!")

    mp_type = None
    if tp_orders:
        mp_type = 'tp'
    elif shp_orders:
        mp_type = 'shp'
    elif lz_orders:
        mp_type = 'lz'

    order_statuses = records.mapped('order_status')
    allowed_statuses = ['ready-process', 'process', 'ready-ship']
    if not all(order_status in allowed_statuses for order_status in order_statuses):
        raise Warning("The status of your selected orders should be in ['ready-process', 'process', 'ready-ship']")
    form_view = env.ref('juragan_product.sale_cancel_form')
    action = {
        'name': 'Cancel Order',
        'view_mode': 'form',
        'res_model': 'sale.cancel.wizard',
        'view_id': form_view.id,
        'type': 'ir.actions.act_window',
        'target': 'new',
        'context': {'mp_type': mp_type, 'order_ids': records.ids},
    }
else:
    raise Warning("Please select sale order first!")
            </field>
        </record>
    </data>
</odoo>